{
  "application": "ml-training-pipelines",
  "keepWaitingPipelines": false,
  "limitConcurrent": true,
  "name": "production-rollback",
  "notifications": [],
  "parameterConfig": [
    {
      "default": "",
      "description": "Version of the App to deploy e.g. \"v23\". To deploy your branch use branch name without \"-deploy\" suffix e.g. \"jdoe.feature-branch-name\"",
      "hasOptions": false,
      "name": "gitRef",
      "pinned": true,
      "required": true
    }
  ],
  "stages": [
    {
      "completeOtherBranchesThenFail": false,
      "continuePipeline": false,
      "failPipeline": true,
      "gitRef": "${parameters.gitRef}",
      "instructions": "This is a buddy check. It requires user approval for the pipeline to continue.\n\nThis pipeline will deploy \u003cb\u003e${ trigger['parameters']['gitRef'] }\u003c/b\u003e\n\n\u003ca href=${ trigger['parameters']['gitRef'] == \"master\" || trigger['parameters']['gitRef'] == \"main\" ? \"https://github.com/zendesk/ml-training-pipelines\" : trigger['parameters']['gitRef'] matches \"v(\\d+)[\\.\\d+]*\" ? \"https://github.com/zendesk/ml-training-pipelines/releases/${trigger['parameters']['gitRef']}\" : \"https://github.com/zendesk/ml-training-pipelines/commits/${trigger['parameters']['gitRef']}\"}\u003e View ${trigger['parameters']['gitRef']}\u003c/a\u003e\n",
      "name": "Buddy",
      "notifications": [],
      "refId": "buddy",
      "requisiteStageRefIds": [],
      "sendNotifications": true,
      "type": "buddy"
    },
    {
      "application": "ml-training-pipelines",
      "comments": "\u003cdiv style=\"padding: 15px; margin-bottom: 5px;\"\u003e\n    \u003cdiv class=\"row\"\u003e\n        \u003cdiv class=\"col-md-12\"\u003e\n            \u003cdl class=\"dl-horizontal\"\u003e\n                \u003cdiv\u003e\n                    \u003cdt\u003eDeployment Status\u003c/dt\u003e\n                    \u003cdd\u003e\n                        \u003ca href=\"https://zendesk.datadoghq.com/orchestration/overview/deployment?tags=kube_app_name%3Aml-training-pipelines%2Ckube_cluster_name%3Apod26\"\u003eDeployment Status\u003c/a\u003e\n                    \u003c/dd\u003e\n                \u003c/div\u003e\n            \u003c/dl\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\u003c/div\u003e\n",
      "completeOtherBranchesThenFail": false,
      "continuePipeline": true,
      "failPipeline": false,
      "name": "pod26",
      "pipeline": "${#pipelineId(\"pod26\")}",
      "pipelineParameters": {
        "gitRef": "${ trigger.parameters.gitRef }",
        "rollback": "true"
      },
      "refId": "pod26",
      "requisiteStageRefIds": [
        "buddy"
      ],
      "skipDownstreamOutput": true,
      "type": "pipeline",
      "waitForCompletion": true
    },
    {
      "application": "ml-training-pipelines",
      "comments": "\u003cdiv style=\"padding: 15px; margin-bottom: 5px;\"\u003e\n    \u003cdiv class=\"row\"\u003e\n        \u003cdiv class=\"col-md-12\"\u003e\n            \u003cdl class=\"dl-horizontal\"\u003e\n                \u003cdiv\u003e\n                    \u003cdt\u003eDeployment Status\u003c/dt\u003e\n                    \u003cdd\u003e\n                        \u003ca href=\"https://zendesk.datadoghq.com/orchestration/overview/deployment?tags=kube_app_name%3Aml-training-pipelines%2Ckube_cluster_name%3Apod15\"\u003eDeployment Status\u003c/a\u003e\n                    \u003c/dd\u003e\n                \u003c/div\u003e\n            \u003c/dl\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\u003c/div\u003e\n",
      "completeOtherBranchesThenFail": false,
      "continuePipeline": true,
      "failPipeline": false,
      "name": "pod15",
      "pipeline": "${#pipelineId(\"pod15\")}",
      "pipelineParameters": {
        "gitRef": "${ trigger.parameters.gitRef }",
        "rollback": "true"
      },
      "refId": "pod15",
      "requisiteStageRefIds": [
        "buddy"
      ],
      "skipDownstreamOutput": true,
      "type": "pipeline",
      "waitForCompletion": true
    },
    {
      "application": "ml-training-pipelines",
      "comments": "\u003cdiv style=\"padding: 15px; margin-bottom: 5px;\"\u003e\n    \u003cdiv class=\"row\"\u003e\n        \u003cdiv class=\"col-md-12\"\u003e\n            \u003cdl class=\"dl-horizontal\"\u003e\n                \u003cdiv\u003e\n                    \u003cdt\u003eDeployment Status\u003c/dt\u003e\n                    \u003cdd\u003e\n                        \u003ca href=\"https://zendesk.datadoghq.com/orchestration/overview/deployment?tags=kube_app_name%3Aml-training-pipelines%2Ckube_cluster_name%3Apod27\"\u003eDeployment Status\u003c/a\u003e\n                    \u003c/dd\u003e\n                \u003c/div\u003e\n            \u003c/dl\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\u003c/div\u003e\n",
      "completeOtherBranchesThenFail": false,
      "continuePipeline": true,
      "failPipeline": false,
      "name": "pod27",
      "pipeline": "${#pipelineId(\"pod27\")}",
      "pipelineParameters": {
        "gitRef": "${ trigger.parameters.gitRef }",
        "rollback": "true"
      },
      "refId": "pod27",
      "requisiteStageRefIds": [
        "buddy"
      ],
      "skipDownstreamOutput": true,
      "type": "pipeline",
      "waitForCompletion": true
    },
    {
      "application": "ml-training-pipelines",
      "comments": "\u003cdiv style=\"padding: 15px; margin-bottom: 5px;\"\u003e\n    \u003cdiv class=\"row\"\u003e\n        \u003cdiv class=\"col-md-12\"\u003e\n            \u003cdl class=\"dl-horizontal\"\u003e\n                \u003cdiv\u003e\n                    \u003cdt\u003eDeployment Status\u003c/dt\u003e\n                    \u003cdd\u003e\n                        \u003ca href=\"https://zendesk.datadoghq.com/orchestration/overview/deployment?tags=kube_app_name%3Aml-training-pipelines%2Ckube_cluster_name%3Apod19\"\u003eDeployment Status\u003c/a\u003e\n                    \u003c/dd\u003e\n                \u003c/div\u003e\n            \u003c/dl\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\u003c/div\u003e\n",
      "completeOtherBranchesThenFail": false,
      "continuePipeline": true,
      "failPipeline": false,
      "name": "pod19",
      "pipeline": "${#pipelineId(\"pod19\")}",
      "pipelineParameters": {
        "gitRef": "${ trigger.parameters.gitRef }",
        "rollback": "true"
      },
      "refId": "pod19",
      "requisiteStageRefIds": [
        "buddy"
      ],
      "skipDownstreamOutput": true,
      "type": "pipeline",
      "waitForCompletion": true
    },
    {
      "application": "ml-training-pipelines",
      "comments": "\u003cdiv style=\"padding: 15px; margin-bottom: 5px;\"\u003e\n    \u003cdiv class=\"row\"\u003e\n        \u003cdiv class=\"col-md-12\"\u003e\n            \u003cdl class=\"dl-horizontal\"\u003e\n                \u003cdiv\u003e\n                    \u003cdt\u003eDeployment Status\u003c/dt\u003e\n                    \u003cdd\u003e\n                        \u003ca href=\"https://zendesk.datadoghq.com/orchestration/overview/deployment?tags=kube_app_name%3Aml-training-pipelines%2Ckube_cluster_name%3Apod25\"\u003eDeployment Status\u003c/a\u003e\n                    \u003c/dd\u003e\n                \u003c/div\u003e\n            \u003c/dl\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\u003c/div\u003e\n",
      "completeOtherBranchesThenFail": false,
      "continuePipeline": true,
      "failPipeline": false,
      "name": "pod25",
      "pipeline": "${#pipelineId(\"pod25\")}",
      "pipelineParameters": {
        "gitRef": "${ trigger.parameters.gitRef }",
        "rollback": "true"
      },
      "refId": "pod25",
      "requisiteStageRefIds": [
        "buddy"
      ],
      "skipDownstreamOutput": true,
      "type": "pipeline",
      "waitForCompletion": true
    },
    {
      "application": "ml-training-pipelines",
      "comments": "\u003cdiv style=\"padding: 15px; margin-bottom: 5px;\"\u003e\n    \u003cdiv class=\"row\"\u003e\n        \u003cdiv class=\"col-md-12\"\u003e\n            \u003cdl class=\"dl-horizontal\"\u003e\n                \u003cdiv\u003e\n                    \u003cdt\u003eDeployment Status\u003c/dt\u003e\n                    \u003cdd\u003e\n                        \u003ca href=\"https://app.datadoghq.eu/orchestration/overview/deployment?tags=kube_app_name%3Aml-training-pipelines%2Ckube_cluster_name%3Apod18\"\u003eDeployment Status\u003c/a\u003e\n                    \u003c/dd\u003e\n                \u003c/div\u003e\n            \u003c/dl\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\u003c/div\u003e\n",
      "completeOtherBranchesThenFail": false,
      "continuePipeline": true,
      "failPipeline": false,
      "name": "pod18",
      "pipeline": "${#pipelineId(\"pod18\")}",
      "pipelineParameters": {
        "gitRef": "${ trigger.parameters.gitRef }",
        "rollback": "true"
      },
      "refId": "pod18",
      "requisiteStageRefIds": [
        "buddy"
      ],
      "skipDownstreamOutput": true,
      "type": "pipeline",
      "waitForCompletion": true
    },
    {
      "application": "ml-training-pipelines",
      "comments": "\u003cdiv style=\"padding: 15px; margin-bottom: 5px;\"\u003e\n    \u003cdiv class=\"row\"\u003e\n        \u003cdiv class=\"col-md-12\"\u003e\n            \u003cdl class=\"dl-horizontal\"\u003e\n                \u003cdiv\u003e\n                    \u003cdt\u003eDeployment Status\u003c/dt\u003e\n                    \u003cdd\u003e\n                        \u003ca href=\"https://zendesk.datadoghq.com/orchestration/overview/deployment?tags=kube_app_name%3Aml-training-pipelines%2Ckube_cluster_name%3Apod20\"\u003eDeployment Status\u003c/a\u003e\n                    \u003c/dd\u003e\n                \u003c/div\u003e\n            \u003c/dl\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\u003c/div\u003e\n",
      "completeOtherBranchesThenFail": false,
      "continuePipeline": true,
      "failPipeline": false,
      "name": "pod20",
      "pipeline": "${#pipelineId(\"pod20\")}",
      "pipelineParameters": {
        "gitRef": "${ trigger.parameters.gitRef }",
        "rollback": "true"
      },
      "refId": "pod20",
      "requisiteStageRefIds": [
        "buddy"
      ],
      "skipDownstreamOutput": true,
      "type": "pipeline",
      "waitForCompletion": true
    },
    {
      "application": "ml-training-pipelines",
      "comments": "\u003cdiv style=\"padding: 15px; margin-bottom: 5px;\"\u003e\n    \u003cdiv class=\"row\"\u003e\n        \u003cdiv class=\"col-md-12\"\u003e\n            \u003cdl class=\"dl-horizontal\"\u003e\n                \u003cdiv\u003e\n                    \u003cdt\u003eDeployment Status\u003c/dt\u003e\n                    \u003cdd\u003e\n                        \u003ca href=\"https://app.datadoghq.eu/orchestration/overview/deployment?tags=kube_app_name%3Aml-training-pipelines%2Ckube_cluster_name%3Apod29\"\u003eDeployment Status\u003c/a\u003e\n                    \u003c/dd\u003e\n                \u003c/div\u003e\n            \u003c/dl\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\u003c/div\u003e\n",
      "completeOtherBranchesThenFail": false,
      "continuePipeline": true,
      "failPipeline": false,
      "name": "pod29",
      "pipeline": "${#pipelineId(\"pod29\")}",
      "pipelineParameters": {
        "gitRef": "${ trigger.parameters.gitRef }",
        "rollback": "true"
      },
      "refId": "pod29",
      "requisiteStageRefIds": [
        "buddy"
      ],
      "skipDownstreamOutput": true,
      "type": "pipeline",
      "waitForCompletion": true
    },
    {
      "application": "ml-training-pipelines",
      "comments": "\u003cdiv style=\"padding: 15px; margin-bottom: 5px;\"\u003e\n    \u003cdiv class=\"row\"\u003e\n        \u003cdiv class=\"col-md-12\"\u003e\n            \u003cdl class=\"dl-horizontal\"\u003e\n                \u003cdiv\u003e\n                    \u003cdt\u003eDeployment Status\u003c/dt\u003e\n                    \u003cdd\u003e\n                        \u003ca href=\"https://zendesk.datadoghq.com/orchestration/overview/deployment?tags=kube_app_name%3Aml-training-pipelines%2Ckube_cluster_name%3Apod13\"\u003eDeployment Status\u003c/a\u003e\n                    \u003c/dd\u003e\n                \u003c/div\u003e\n            \u003c/dl\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\u003c/div\u003e\n",
      "completeOtherBranchesThenFail": false,
      "continuePipeline": true,
      "failPipeline": false,
      "name": "pod13",
      "pipeline": "${#pipelineId(\"pod13\")}",
      "pipelineParameters": {
        "gitRef": "${ trigger.parameters.gitRef }",
        "rollback": "true"
      },
      "refId": "pod13",
      "requisiteStageRefIds": [
        "buddy"
      ],
      "skipDownstreamOutput": true,
      "type": "pipeline",
      "waitForCompletion": true
    },
    {
      "application": "ml-training-pipelines",
      "comments": "\u003cdiv style=\"padding: 15px; margin-bottom: 5px;\"\u003e\n    \u003cdiv class=\"row\"\u003e\n        \u003cdiv class=\"col-md-12\"\u003e\n            \u003cdl class=\"dl-horizontal\"\u003e\n                \u003cdiv\u003e\n                    \u003cdt\u003eDeployment Status\u003c/dt\u003e\n                    \u003cdd\u003e\n                        \u003ca href=\"https://app.datadoghq.eu/orchestration/overview/deployment?tags=kube_app_name%3Aml-training-pipelines%2Ckube_cluster_name%3Apod17\"\u003eDeployment Status\u003c/a\u003e\n                    \u003c/dd\u003e\n                \u003c/div\u003e\n            \u003c/dl\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\u003c/div\u003e\n",
      "completeOtherBranchesThenFail": false,
      "continuePipeline": true,
      "failPipeline": false,
      "name": "pod17",
      "pipeline": "${#pipelineId(\"pod17\")}",
      "pipelineParameters": {
        "gitRef": "${ trigger.parameters.gitRef }",
        "rollback": "true"
      },
      "refId": "pod17",
      "requisiteStageRefIds": [
        "buddy"
      ],
      "skipDownstreamOutput": true,
      "type": "pipeline",
      "waitForCompletion": true
    },
    {
      "application": "ml-training-pipelines",
      "comments": "\u003cdiv style=\"padding: 15px; margin-bottom: 5px;\"\u003e\n    \u003cdiv class=\"row\"\u003e\n        \u003cdiv class=\"col-md-12\"\u003e\n            \u003cdl class=\"dl-horizontal\"\u003e\n                \u003cdiv\u003e\n                    \u003cdt\u003eDeployment Status\u003c/dt\u003e\n                    \u003cdd\u003e\n                        \u003ca href=\"https://zendesk.datadoghq.com/orchestration/overview/deployment?tags=kube_app_name%3Aml-training-pipelines%2Ckube_cluster_name%3Apod23\"\u003eDeployment Status\u003c/a\u003e\n                    \u003c/dd\u003e\n                \u003c/div\u003e\n            \u003c/dl\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\u003c/div\u003e\n",
      "completeOtherBranchesThenFail": false,
      "continuePipeline": true,
      "failPipeline": false,
      "name": "pod23",
      "pipeline": "${#pipelineId(\"pod23\")}",
      "pipelineParameters": {
        "gitRef": "${ trigger.parameters.gitRef }",
        "rollback": "true"
      },
      "refId": "pod23",
      "requisiteStageRefIds": [
        "buddy"
      ],
      "skipDownstreamOutput": true,
      "type": "pipeline",
      "waitForCompletion": true
    },
    {
      "application": "ml-training-pipelines",
      "comments": "\u003cdiv style=\"padding: 15px; margin-bottom: 5px;\"\u003e\n    \u003cdiv class=\"row\"\u003e\n        \u003cdiv class=\"col-md-12\"\u003e\n            \u003cdl class=\"dl-horizontal\"\u003e\n                \u003cdiv\u003e\n                    \u003cdt\u003eDeployment Status\u003c/dt\u003e\n                    \u003cdd\u003e\n                        \u003ca href=\"https://app.datadoghq.eu/orchestration/overview/deployment?tags=kube_app_name%3Aml-training-pipelines%2Ckube_cluster_name%3Apod28\"\u003eDeployment Status\u003c/a\u003e\n                    \u003c/dd\u003e\n                \u003c/div\u003e\n            \u003c/dl\u003e\n        \u003c/div\u003e\n    \u003c/div\u003e\n\u003c/div\u003e\n",
      "completeOtherBranchesThenFail": false,
      "continuePipeline": true,
      "failPipeline": false,
      "name": "pod28",
      "pipeline": "${#pipelineId(\"pod28\")}",
      "pipelineParameters": {
        "gitRef": "${ trigger.parameters.gitRef }",
        "rollback": "true"
      },
      "refId": "pod28",
      "requisiteStageRefIds": [
        "buddy"
      ],
      "skipDownstreamOutput": true,
      "type": "pipeline",
      "waitForCompletion": true
    },
    {
      "completeOtherBranchesThenFail": false,
      "continuePipeline": false,
      "failPipeline": false,
      "name": "Rollback succeeded",
      "preconditions": [
        {
          "context": {
            "expression": "${ #stageByRefId(\"pod26\").status == \"SUCCEEDED\" \u0026\u0026 #stageByRefId(\"pod15\").status == \"SUCCEEDED\" \u0026\u0026 #stageByRefId(\"pod27\").status == \"SUCCEEDED\" \u0026\u0026 #stageByRefId(\"pod19\").status == \"SUCCEEDED\" \u0026\u0026 #stageByRefId(\"pod25\").status == \"SUCCEEDED\" \u0026\u0026 #stageByRefId(\"pod18\").status == \"SUCCEEDED\" \u0026\u0026 #stageByRefId(\"pod20\").status == \"SUCCEEDED\" \u0026\u0026 #stageByRefId(\"pod29\").status == \"SUCCEEDED\" \u0026\u0026 #stageByRefId(\"pod13\").status == \"SUCCEEDED\" \u0026\u0026 #stageByRefId(\"pod17\").status == \"SUCCEEDED\" \u0026\u0026 #stageByRefId(\"pod23\").status == \"SUCCEEDED\" \u0026\u0026 #stageByRefId(\"pod28\").status == \"SUCCEEDED\" }",
            "failureMessage": "One of the previous steps failed"
          },
          "failPipeline": true,
          "type": "expression"
        }
      ],
      "refId": "rollback-succeeded",
      "requisiteStageRefIds": [
        "pod26",
        "pod15",
        "pod27",
        "pod19",
        "pod25",
        "pod18",
        "pod20",
        "pod29",
        "pod13",
        "pod17",
        "pod23",
        "pod28"
      ],
      "type": "checkPreconditions"
    },
    {
      "completeOtherBranchesThenFail": false,
      "continuePipeline": false,
      "failPipeline": false,
      "name": "Rollback failed",
      "preconditions": [
        {
          "context": {
            "expression": "${ #stageByRefId(\"pod26\").status == \"FAILED_CONTINUE\" || #stageByRefId(\"pod15\").status == \"FAILED_CONTINUE\" || #stageByRefId(\"pod27\").status == \"FAILED_CONTINUE\" || #stageByRefId(\"pod19\").status == \"FAILED_CONTINUE\" || #stageByRefId(\"pod25\").status == \"FAILED_CONTINUE\" || #stageByRefId(\"pod18\").status == \"FAILED_CONTINUE\" || #stageByRefId(\"pod20\").status == \"FAILED_CONTINUE\" || #stageByRefId(\"pod29\").status == \"FAILED_CONTINUE\" || #stageByRefId(\"pod13\").status == \"FAILED_CONTINUE\" || #stageByRefId(\"pod17\").status == \"FAILED_CONTINUE\" || #stageByRefId(\"pod23\").status == \"FAILED_CONTINUE\" || #stageByRefId(\"pod28\").status == \"FAILED_CONTINUE\" }",
            "failureMessage": "One of the previous steps failed"
          },
          "failPipeline": false,
          "type": "expression"
        }
      ],
      "refId": "rollback-failed",
      "requisiteStageRefIds": [
        "pod26",
        "pod15",
        "pod27",
        "pod19",
        "pod25",
        "pod18",
        "pod20",
        "pod29",
        "pod13",
        "pod17",
        "pod23",
        "pod28"
      ],
      "type": "checkPreconditions"
    },
    {
      "completeOtherBranchesThenFail": false,
      "continuePipeline": false,
      "failPipeline": true,
      "name": "Report Failure",
      "preconditions": [
        {
          "context": {
            "expression": "false",
            "failureMessage": "Pipeline execution halted; see execution details for further information\n"
          },
          "failPipeline": true,
          "type": "expression"
        }
      ],
      "refId": "report-failure",
      "requisiteStageRefIds": [
        "rollback-failed"
      ],
      "type": "checkPreconditions"
    }
  ],
  "triggers": []
}